# Production Overlay
# Applies production-specific patches to base

apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

metadata:
  name: kubernetes-lab-production

# Namespace for production
namespace: kubernetes-lab-prod

# Include base resources
resources:
  - ../../base

# Production-specific labels
commonLabels:
  environment: production
  tier: production

# Production annotations
commonAnnotations:
  kubernetes-lab/environment: production

# Name suffix for production
nameSuffix: -prod

# ConfigMap overrides for production
configMapGenerator:
  - name: app-config
    behavior: merge
    literals:
      - LOG_LEVEL=warning
      - ENVIRONMENT=production
      - ENABLE_DEBUG=false

# Patches for production
patches:
  # Increase replica count
  - patch: |-
      - op: replace
        path: /spec/replicas
        value: 3
    target:
      kind: Deployment
      labelSelector: "environment=production"

  # Add resource limits
  - patch: |-
      apiVersion: v1
      kind: Pod
      metadata:
        name: any
      spec:
        containers:
          - name: '*'
            resources:
              limits:
                cpu: 500m
                memory: 512Mi
              requests:
                cpu: 100m
                memory: 128Mi
    target:
      kind: Deployment

# Replica count for all deployments
replicas:
  - name: any-deployment
    count: 3
